const mapMark = Vue.component('map-mark', {
template: `<div class="map_mark">
    <div class="city_state_head area_es_head">
        <div class="title_line"></div>
        <div class="city_state_title">
            <span class="title_text">地图标注</span>
        </div>
    </div>
    <div id="map-container" style="width:500px; height:500px"></div>
</div>`,
data() {
return {
map: null,
/* 当前位置 */
thisPosition: {
location: '',
lng: '',
lat: ''
},
/* 选取的位置 */
chosePosition: {
location: '',
lng: '',
lat: ''
},
/* 范围圆的数据 */
myCircle: {},
/* 编辑器对象 */
circleEditor: null,
/* 拖拽对象 */
positionPickerObj: {},
/* 当前城市编码 */
citycode: '020'
}
},
created() {
// var map = new AMap.Map('id-map-container', {
// resizeEnable: true, //是否监控地图容器尺寸变化
// zoom: 11, //初始化地图层级
// mapStyle: 'amap://styles/a92c23c68ca519ec235825c3be99462b',
// center: [116.397428, 39.90923] //初始化地图中心点
// });
// map.plugin(['AMap.ToolBar'], function () {
// map.addControl(new AMap.ToolBar({
// position: 'RB'
// }))
// })
// console.log('地图map', map)
},
mounted() {
this.map = new AMap.Map('map-container', {
resizeEnable: true,
zoom: 15,
viewMode: '2D',
zooms: [4, 18]
})
/* 添加工具条 */
this.addTool()
/* 获取当前位置 */
this.thisLocation()
/* 添加搜索功能 */
},
methods: {
addTool() {
AMap.plugin(['AMap.ToolBar', 'AMap.Driving'], () => {
let toolbar = new AMap.ToolBar()
this.map.addControl(toolbar)
})
},
/* 定位具体位置 */
thisLocation() {
this.map.plugin('AMap.Geolocation', () => {
let geolocation = new AMap.Geolocation({
// 是否使用高精度定位，默认：true
enableHighAccuracy: true,
// 设置定位超时时间，默认：无穷大
timeout: 10000,
// 定位按钮的停靠位置的偏移量，默认：Pixel(10, 20)
buttonOffset: new AMap.Pixel(10, 20),
// 定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
zoomToAccuracy: false,
// 定位按钮的排放位置, RB表示右下
buttonPosition: 'RB'
})
this.map.addControl(geolocation)
geolocation.getCurrentPosition()
AMap.event.addListener(geolocation, 'complete', (data) => {
console.log(data)
this.citycode = data.addressComponent.cityCode
this.thisPosition = data.position
this.thisPosition.message = data.formattedAddress
this.chosePosition = this.thisPosition
/* 画圆 */
this.cancelLocation()
this.addCircle()
/* 拖拽选址 */
this.positionPicker()
})
AMap.event.addListener(geolocation, 'error', function (data) {
alert('定位失败')
})
})
},



}
});